#{extends 'main.html' /}
#{set title:'inspirednetwork.html' /}

<head>

  <script src="http://sigmajs.org/js/prettify.js"></script>
  <script src="http://sigmajs.org/js/sigma.min.js"></script>

  <script type="text/javascript">
     var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-29798319-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  </script>

<script type="text/javascript">
function init() {
  var jsonText = document.getElementById("data").innerHTML;
  var projectNameArray = JSON.parse(jsonText);
  var sigInst = sigma.init(document.getElementById('sigma-example-parent')).drawingProperties({
    defaultLabelColor: '#fff',
    defaultLabelSize: 14,
    defaultLabelBGColor: '#fff',
    defaultLabelHoverColor: '#000',
    labelThreshold: 6,
    defaultEdgeType: 'curve'
  }).graphProperties({
    minNodeSize: 0.5,
    maxNodeSize: 5,
    minEdgeSize: 1,
    maxEdgeSize: 1
  }).mouseProperties({
    maxRatio: 4
  });
 
  for (var i = 0; i < projectNameArray.length; i++) {
     sigInst.addNode(
        projectNameArray[i], 
       {
          'x': Math.random() * 10,
          'y': Math.random() * 10,
          'size': 4,
          'color': 'rgb(206,253,56)',
        }
     );
  }    
 
  sigInst.addEdge(1, "foo", "bar");
 
  // Bind events :
  var greyColor = '#666';
  sigInst.bind('overnodes',function(event){
    var nodes = event.content;
    var neighbors = {};
    sigInst.iterEdges(function(e){
      if(nodes.indexOf(e.source)<0 && nodes.indexOf(e.target)<0){
        if(!e.attr['grey']){
          e.attr['true_color'] = e.color;
          e.color = greyColor;
          e.attr['grey'] = 1;
        }
      }else{
        e.color = e.attr['grey'] ? e.attr['true_color'] : e.color;
        e.attr['grey'] = 0;
 
        neighbors[e.source] = 1;
        neighbors[e.target] = 1;
      }
    }).iterNodes(function(n){
      if(!neighbors[n.id]){
        if(!n.attr['grey']){
          n.attr['true_color'] = n.color;
          n.color = greyColor;
          n.attr['grey'] = 1;
        }
      }else{
        n.color = n.attr['grey'] ? n.attr['true_color'] : n.color;
        n.attr['grey'] = 0;
      }
    }).draw(2,2,2);
  }).bind('outnodes',function(){
    sigInst.iterEdges(function(e){
      e.color = e.attr['grey'] ? e.attr['true_color'] : e.color;
      e.attr['grey'] = 0;
    }).iterNodes(function(n){
      n.color = n.attr['grey'] ? n.attr['true_color'] : n.color;
      n.attr['grey'] = 0;
    }).draw(2,2,2);
  });
 
  // Draw the graph :
  sigInst.draw();
}
 
if (document.addEventListener) {
  document.addEventListener("DOMContentLoaded", init, false);
} else {
  window.onready = init;
}
</script>

<style type="text/css">
  .sigma-parent {
    position: relative;
    border-radius: 4px;
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    background: #222;
    height: 500px;
    width: 852px;
  }  
  .status-area {
    position: absolute;
    border-radius: 4px;
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    background: #EEE;
    width: 350px;
    height 500px;
    top: 0px;
    left: 502px;
    font-family:sans-serif;
  }
</style>

</head>
<body>
  <div id="data" style="display:none;">${projectNamesJson}</div>
  <div class="container">
    <div class="span12 sigma-parent" id="sigma-example-parent">
      <span class="sigma-expand" id="node-demo"></span>
      <span id="status" class="status-area"></span>
    </div>
</div>

</body>